       
  name: Eroha Core CI/CD

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 9 * * *' # –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00 UTC

jobs:
  validate-core:
    runs-on: ubuntu-latest
    steps:
      - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º YAML-—Ñ–∞–π–ª—ã
        run: |
          pip install yamllint
          yamllint . --strict

      - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º JSON-—Ñ–∞–π–ª—ã
        run: |
          for f in $(find . -name "*.json"); do
            echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º $f"
            python -m json.tool < $f > /dev/null || exit 1
          done

      - name: üîí –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
        run: |
          if [ -f ErohaPRO_Implementation_Plan_v1.md ]; then
            sha256sum ErohaPRO_Implementation_Plan_v1.md || true
          else
            echo "–§–∞–π–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥."
          fi

  powershell-check:
    name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ PowerShell —Å–∫—Ä–∏–ø—Ç–æ–≤
    runs-on: windows-latest
    steps:
      - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å PowerShell-—Ñ–∞–π–ª–æ–≤
        shell: pwsh
        run: |
          $ErrorActionPreference = "Stop"
          $psFiles = Get-ChildItem -Path . -Recurse -Include *.ps1 -ErrorAction SilentlyContinue
          if ($psFiles.Count -eq 0) {
            Write-Host "PowerShell —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, —à–∞–≥ –ø—Ä–æ–ø—É—â–µ–Ω."
          } else {
            foreach ($file in $psFiles) {
              Write-Host "–ü—Ä–æ–≤–µ—Ä—è–µ–º $($file.FullName)"
              try {
                pwsh -NoLogo -NoProfile -Command "Get-Command '$($file.FullName)' | Out-Null"
              } catch {
                Write-Error "–û—à–∏–±–∫–∞ –≤ $($file.FullName): $_"
                exit 1
              }
            }
          }

  build-archive:
    name: üì¶ –°–±–æ—Ä–∫–∞ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —è–¥—Ä–∞ Eroha Core
    runs-on: ubuntu-latest
    needs: [validate-core, powershell-check]
    steps:
      - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: üóúÔ∏è –°–æ–∑–¥–∞—ë–º –∞—Ä—Ö–∏–≤ —è–¥—Ä–∞
        run: |
          mkdir -p artifacts
          zip -r artifacts/ErohaSuite_Core.zip . -x "*.git*" ".github/*" "__pycache__/*"

      - name: üöÄ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
        uses: actions/upload-artifact@v3
        with:
          name: ErohaSuite_Core_Build
          path: artifacts/ErohaSuite_Core.zip
          
  release:
    name: üèÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–ª–∏–∑–∞
    runs-on: ubuntu-latest
    needs: [build-archive]
    steps:
      - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: üè∑Ô∏è –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏
        id: version
        run: echo "VERSION=v$(date +'%Y.%m.%d.%H%M')" >> $GITHUB_ENV

      - name: üöÄ –ü—É–±–ª–∏–∫—É–µ–º —Ä–µ–ª–∏–∑ –Ω–∞ GitHub
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ env.VERSION }}
          name: "Eroha Core Release ${{ env.VERSION }}"
          body: |
            ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ Eroha Core.
            üì¶ –í–∫–ª—é—á–µ–Ω—ã: —è–¥—Ä–æ, PowerShell-—Å–∫—Ä–∏–ø—Ç—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.
          files: artifacts/ErohaSuite_Core.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
