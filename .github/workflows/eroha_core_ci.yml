name: Eroha Core CI/CD
on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 9 * * *' # –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00 UTC

jobs:
  validate-core:
    runs-on: ubuntu-latest
    steps:
      - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º YAML-—Ñ–∞–π–ª—ã
        run: |
          pip install yamllint
          yamllint . --strict

      - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º JSON-—Ñ–∞–π–ª—ã
        run: |
          for f in $(find . -name "*.json"); do
            python -m json.tool < $f > /dev/null || exit 1
          done

      - name: üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
        run: |
          sha256sum ErohaPRO_Implementation_Plan_v1.md || true
          
  powershell-check:
    name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ PowerShell —Å–∫—Ä–∏–ø—Ç–æ–≤
    runs-on: windows-latest
    steps:
      - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å PowerShell-—Ñ–∞–π–ª–æ–≤
        shell: pwsh
        run: |
          $ErrorActionPreference = "Stop"
          Get-ChildItem -Path . -Recurse -Include *.ps1 -ErrorAction SilentlyContinue | ForEach-Object {
            Write-Host "–ü—Ä–æ–≤–µ—Ä—è–µ–º $_ ..."
            try {
              pwsh -NoLogo -NoProfile -Command "Get-Command $_ | Out-Null"
            } catch {
              Write-Error "–û—à–∏–±–∫–∞ –≤ $_"
              exit 1
            }
          }

  build-archive:
    name: üì¶ –°–±–æ—Ä–∫–∞ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —è–¥—Ä–∞ Eroha Core
    runs-on: ubuntu-latest
    needs: [validate-core, powershell-check]
    steps:
      - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v3

      - name: üóúÔ∏è –°–æ–∑–¥–∞—ë–º –∞—Ä—Ö–∏–≤ —è–¥—Ä–∞
        run: |
          zip -r ErohaSuite_Core.zip Core/ Docs/ Memory/ SOP/ Utils/ LegalPack/

      - name: üöÄ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
        uses: actions/upload-artifact@v3
        with:
          name: ErohaSuite_Core_Build
          path: ErohaSuite_Core.zip
